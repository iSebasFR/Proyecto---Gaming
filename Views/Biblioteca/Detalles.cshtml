@model Proyecto_Gaming.Models.Rawg.Game

@{
    ViewData[index: "Title"] = "Detalles del Juego";
}

<div class="game-details-container">
    <div class="row">
        <!-- SECCI√ìN IZQUIERDA - IM√ÅGENES Y MEDIA -->
        <div class="col-md-6">
            <!-- CARRUSEL DE IM√ÅGENES -->
            <div class="image-carousel-section mb-4">
                <div id="gameCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        @{
                            var allImages = new List<string>();
                            if (!string.IsNullOrEmpty(Model.BackgroundImage))
                            {
                                allImages.Add(Model.BackgroundImage);
                            }
                            if (Model.ShortScreenshots != null)
                            {
                                allImages.AddRange(Model.ShortScreenshots.Select(s => s.Image ?? "").Where(img => !string.IsNullOrEmpty(img)));
                            }
                            
                            for (int i = 0; i < allImages.Count; i++)
                            {
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@allImages[i]" class="d-block w-100 carousel-image" alt="Screenshot @(i+1)">
                                </div>
                            }
                        }
                    </div>
                    
                    @if (allImages.Count > 1)
                    {
                        <button class="carousel-control-prev" type="button" data-bs-target="#gameCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Anterior</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#gameCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Siguiente</span>
                        </button>
                    }
                </div>

                <!-- MINIATURAS -->
                @if (allImages.Count > 1)
                {
                    <div class="carousel-thumbnails mt-3">
                        @for (int i = 0; i < allImages.Count; i++)
                        {
                            <img src="@allImages[i]" class="thumbnail-img @(i == 0 ? "active" : "")" 
                                 data-bs-target="#gameCarousel" data-bs-slide-to="@i" alt="Thumb @(i+1)">
                        }
                    </div>
                }
            </div>

            <!-- SECCI√ìN DE TR√ÅILERS -->
            @if (Model.Trailers != null && Model.Trailers.Any(t => !string.IsNullOrEmpty(t.Preview)))
            {
                <div class="trailer-section">
                    <h4 class="section-title">üé¨ Tr√°ilers</h4>
                    <div class="trailer-container">
                        @foreach (var trailer in Model.Trailers.Take(2).Where(t => !string.IsNullOrEmpty(t.Preview)))
                        {
                            <div class="trailer-item mb-3">
                                <h6 class="trailer-title">@(trailer.Name ?? "Tr√°iler")</h6>
                                <div class="video-wrapper">
                                    <video controls class="w-100 trailer-video" poster="@Model.BackgroundImage">
                                        <source src="@trailer.Preview" type="video/mp4">
                                        Tu navegador no soporta el elemento video.
                                    </video>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <!-- Informaci√≥n del Juego -->
        <div class="col-md-6">
            <div class="game-info">
                <!-- PRECIO PRINCIPAL (usaremos ViewData para esto) -->
                <div class="price-main-section mb-4 p-3">
                    @if (ViewData["CurrentPrice"] != null)
                    {
                        <div class="main-price display-4 text-success fw-bold mb-1">
                            $@ViewData["CurrentPrice"]
                        </div>
                        <div class="price-source text-muted small">
                            üí∞ Mejor precio en <strong>@ViewData["BestStore"]</strong>
                        </div>
                        @if (ViewData["IsOnSale"] as bool? == true)
                        {
                            <div class="sale-badge badge bg-danger mt-2">
                                üî• EN OFERTA
                            </div>
                        }
                    }
                    else
                    {
                        <div class="price-unavailable text-warning">
                            ‚è≥ Precio no disponible
                        </div>
                    }
                </div>
                
                <h1 class="game-title">@Model.Name</h1>

                <!-- Descripci√≥n del Juego -->
                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <div class="description-section mb-4">
                        <div class="game-detail-label">
                            <i class="fas fa-file-alt"></i>
                            <span>DESCRIPCI√ìN</span>
                        </div>
                        <div class="game-description mt-2">
                            @Html.Raw(Model.Description)
                        </div>
                    </div>
                }

                <!-- Informaci√≥n B√°sica -->
                <div class="game-detail-item">
                    <div class="game-detail-label">
                        <i class="fas fa-calendar-alt"></i>
                        <span>FECHA DE LANZAMIENTO</span>
                    </div>
                    <div class="game-detail-value">
                        @if (!string.IsNullOrEmpty(Model.Released))
                        {
                            @DateTime.Parse(Model.Released).ToString("dd/MM/yyyy")
                        }
                        else
                        {
                            <span class="text-muted">No disponible</span>
                        }
                    </div>
                </div>

                <!-- Rating -->
                <div class="game-detail-item">
                    <div class="game-detail-label">
                        <i class="fas fa-star"></i>
                        <span>RATING</span>
                    </div>
                    <div class="rating-display">
                        <div class="stars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= Model.Rating)
                                {
                                    <i class="fas fa-star"></i>
                                }
                                else if (i - 0.5 <= Model.Rating)
                                {
                                    <i class="fas fa-star-half-alt"></i>
                                }
                                else
                                {
                                    <i class="far fa-star"></i>
                                }
                            }
                        </div>
                        <span class="rating-value">@Model.Rating.ToString("0.0")</span>
                        @if (Model.Metacritic.HasValue)
                        {
                            <span class="metacritic-score" title="Puntuaci√≥n Metacritic">
                                @Model.Metacritic
                            </span>
                        }
                    </div>
                </div>

                <!-- G√©neros -->
                <div class="game-detail-item">
                    <div class="game-detail-label">
                        <i class="fas fa-tags"></i>
                        <span>G√âNEROS</span>
                    </div>
                    <div class="tags-container">
                        @foreach (var genre in Model.Genres)
                        {
                            <span class="badge bg-primary">@genre.Name</span>
                        }
                    </div>
                </div>

                <!-- Plataformas -->
                <div class="game-detail-item">
                    <div class="game-detail-label">
                        <i class="fas fa-gamepad"></i>
                        <span>PLATAFORMAS</span>
                    </div>
                    <div class="tags-container">
                        @foreach (var platform in Model.Platforms)
                        {
                            <span class="badge bg-secondary">@platform.Platform?.Name</span>
                        }
                    </div>
                </div>
                
                <!-- OFERTAS EN TIENDAS -->
                @if (ViewData["StoreOffers"] != null)
                {
                    <div class="store-offers-section mt-4">
                        <div class="game-detail-label">
                            <i class="fas fa-store"></i>
                            <span>OFERTAS EN TIENDAS</span>
                        </div>
                        <div class="store-offers mt-2">
                            @foreach (var offer in (List<Proyecto_Gaming.ViewModels.StoreOffer>)ViewData["StoreOffers"])
                            {
                                <div class="store-offer-card @(offer.IsOnSale ? "on-sale" : "")">
                                    <div class="store-info">
                                        <span class="store-name">@offer.StoreName</span>
                                        <div class="offer-prices">
                                            <span class="current-price">$@offer.Price.ToString("0.00")</span>
                                            @if (offer.IsOnSale)
                                            {
                                                <span class="original-price">$@offer.RetailPrice.ToString("0.00")</span>
                                                <span class="savings-badge">-@offer.Savings%</span>
                                            }
                                        </div>
                                    </div>
                                    <a href="@offer.DealUrl" target="_blank" class="store-link btn btn-outline-primary btn-sm">
                                        Ver
                                    </a>
                                </div>
                            }
                        </div>
                    </div>
                }

                <!-- BOTONES DE ACCI√ìN -->
                <div class="action-buttons">
                    <form asp-controller="Payment" asp-action="Checkout" method="post" class="d-inline">
                        <input type="hidden" name="gameId" value="@Model.Id" />
                        <input type="hidden" name="gameTitle" value="@Model.Name" />
                        <input type="hidden" name="price" value="@(ViewData["CurrentPrice"] ?? "39.99")" />
                        
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-shopping-cart me-2"></i>
                            Comprar @(ViewData["CurrentPrice"] != null ? $" - ${ViewData["CurrentPrice"]}" : "")
                        </button>
                    </form>
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Volver al cat√°logo
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mantener el mismo CSS que ya tienes -->
<style>
    /* PALETA DE COLORES GAMING */
    :root {
        --bg-dark: #070714;
        --bg-primary: #0f0f1f;
        --card-bg: #151530;
        --accent-purple: #8b2ce6;
        --accent-blue: #2c5be6;
        --neon-purple: #b042ff;
        --neon-blue: #428bff;
        --text-primary: #ffffff;
        --text-secondary: #b8b8d0;
        --navbar-bg: rgba(15, 15, 31, 0.95);
    }

    /* CONTENEDOR PRINCIPAL */
    .game-details-container {
        background: var(--card-bg);
        border: 1px solid rgba(139, 44, 230, 0.3);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        position: relative;
        margin-top: 2rem;
    }

    .game-details-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue), var(--neon-purple));
    }

    .game-details-container .row {
        margin: 0;
        padding: 2rem;
    }

    /* IMAGEN DEL JUEGO */
    .game-image {
        border-radius: 15px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 2px solid rgba(139, 44, 230, 0.3);
    }

    .game-image:hover {
        transform: scale(1.02);
        box-shadow: 0 20px 40px rgba(139, 44, 230, 0.3);
    }

    /* INFORMACI√ìN DEL JUEGO */
    .game-info {
        color: var(--text-primary);
    }

    .game-title {
        background: linear-gradient(135deg, var(--neon-purple), var(--neon-blue));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        font-size: 2.5rem;
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        line-height: 1.2;
    }

    .game-detail-item {
        margin-bottom: 1rem;
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(139, 44, 230, 0.2);
    }

    .game-detail-item:last-child {
        border-bottom: none;
    }

    .game-detail-label {
        color: var(--neon-blue);
        font-weight: 700;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.3rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .game-detail-label i {
        font-size: 1.1rem;
    }

    .game-detail-value {
        color: var(--text-primary);
        font-size: 1.1rem;
        font-weight: 600;
    }

    /* RATING Y METACRITIC */
    .rating-display {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .stars {
        display: flex;
        gap: 0.2rem;
    }

    .stars .fas.fa-star,
    .stars .fas.fa-star-half-alt {
        color: #ffd166;
        text-shadow: 0 0 8px rgba(255, 209, 102, 0.5);
        font-size: 1.2rem;
    }

    .stars .far.fa-star {
        color: rgba(255, 255, 255, 0.3);
        font-size: 1.2rem;
    }

    .rating-value {
        background: linear-gradient(135deg, #ffd166, #ff9e00);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        font-size: 1.3rem;
    }

    .metacritic-score {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #6ac045, #2e7d32);
        color: white;
        font-weight: 800;
        font-size: 1.1rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(106, 192, 69, 0.3);
        margin-left: 1rem;
    }

    /* BADGES MEJORADOS */
    .badge.bg-primary {
        background: linear-gradient(135deg, var(--accent-purple), var(--neon-purple)) !important;
        border: none;
        padding: 0.6rem 1rem;
        border-radius: 25px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.8rem;
        margin: 0.2rem 0.3rem;
        box-shadow: 0 4px 10px rgba(139, 44, 230, 0.3);
        transition: all 0.3s ease;
    }

    .badge.bg-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(139, 44, 230, 0.4);
    }

    .badge.bg-secondary {
        background: linear-gradient(135deg, var(--accent-blue), var(--neon-blue)) !important;
        border: none;
        padding: 0.6rem 1rem;
        border-radius: 25px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.8rem;
        margin: 0.2rem 0.3rem;
        box-shadow: 0 4px 10px rgba(66, 139, 255, 0.3);
        transition: all 0.3s ease;
    }

    .badge.bg-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(66, 139, 255, 0.4);
    }

    /* BOTONES DE ACCI√ìN */
    .action-buttons {
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(139, 44, 230, 0.3);
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .btn-success {
        background: linear-gradient(135deg, #06d6a0, #118ab2);
        border: none;
        border-radius: 12px;
        font-weight: 700;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(6, 214, 160, 0.3);
    }

    .btn-success::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .btn-success:hover::before {
        left: 100%;
    }

    .btn-success:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(6, 214, 160, 0.4);
    }

    .btn-secondary {
        background: linear-gradient(135deg, var(--text-secondary), #6c757d);
        border: none;
        border-radius: 12px;
        font-weight: 700;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
    }

    .btn-secondary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .btn-secondary:hover::before {
        left: 100%;
    }

    .btn-secondary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 25px rgba(108, 117, 125, 0.4);
    }

    /* SECCI√ìN DE G√âNEROS Y PLATAFORMAS */
    .tags-section {
        margin: 1.5rem 0;
    }

    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
      /* CARRUSEL DE IM√ÅGENES */
    .carousel-image {
        height: 300px;
        object-fit: cover;
        border-radius: 12px;
        border: 2px solid rgba(139, 44, 230, 0.3);
    }

    .carousel-thumbnails {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding: 5px 0;
    }

    .thumbnail-img {
        width: 70px;
        height: 50px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        opacity: 0.6;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .thumbnail-img.active,
    .thumbnail-img:hover {
        opacity: 1;
        border-color: var(--neon-blue);
        transform: scale(1.05);
    }

    /* SECCI√ìN DE PRECIO PRINCIPAL */
    .price-main-section {
        background: rgba(40, 167, 69, 0.1);
        border-radius: 12px;
        border: 2px solid rgba(40, 167, 69, 0.3);
        text-align: center;
    }

    .main-price {
        text-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
    }

    .sale-badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        animation: pulse 2s infinite;
    }

    /* SECCI√ìN DE DESCRIPCI√ìN */
    .game-description {
        color: var(--text-secondary);
        line-height: 1.6;
        max-height: 200px;
        overflow-y: auto;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 3px solid var(--neon-purple);
    }

    /* SECCI√ìN DE TR√ÅILERS */
    .trailer-section {
        margin-top: 1.5rem;
    }

    .section-title {
        color: var(--neon-blue);
        font-weight: 700;
        margin-bottom: 1rem;
        font-size: 1.2rem;
    }

    .trailer-title {
        color: var(--text-primary);
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .video-wrapper {
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        border: 2px solid rgba(66, 139, 255, 0.3);
    }

    .trailer-video {
        border-radius: 8px;
        background: #000;
    }

    /* OFERTAS EN TIENDAS */
    .store-offers {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .store-offer-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.8rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .store-offer-card:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
    }

    .store-offer-card.on-sale {
        border-color: rgba(255, 193, 7, 0.3);
        background: rgba(255, 193, 7, 0.05);
    }

    .store-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .store-name {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.9rem;
    }

    .offer-prices {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .current-price {
        color: var(--neon-blue);
        font-weight: 700;
        font-size: 1rem;
    }

    .original-price {
        text-decoration: line-through;
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    .savings-badge {
        background: #dc3545;
        color: white;
        padding: 0.1rem 0.4rem;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .store-link {
        font-size: 0.8rem;
        padding: 0.3rem 0.8rem;
    }

    /* ANIMACIONES */
    @@keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }

    /* SCROLLBAR PERSONALIZADO */
    .game-description::-webkit-scrollbar {
        width: 6px;
    }

    .game-description::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
    }

    .game-description::-webkit-scrollbar-thumb {
        background: var(--neon-purple);
        border-radius: 3px;
    }
    
</style>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Miniaturas del carrusel
            document.querySelectorAll('.thumbnail-img').forEach((thumb, index) => {
                thumb.addEventListener('click', function() {
                    document.querySelectorAll('.thumbnail-img').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Control de videos
            document.querySelectorAll('.trailer-video').forEach(video => {
                video.addEventListener('mouseenter', function() {
                    this.play().catch(e => console.log('Auto-play prevented:', e));
                });
                
                video.addEventListener('mouseleave', function() {
                    this.pause();
                });

                // Evitar auto-play con sonido
                video.volume = 0;
            });
        });
    </script>
}